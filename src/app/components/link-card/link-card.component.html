<ng-template #icon>
  <div (click)="clickIcon($event, link)">
    <img (error)="globals.noImage($event)" *ngIf="link.children==null" [src]="link.favicon" alt="favicon">
    <mat-icon *ngIf="link.children!=null">
      <ng-container *ngIf="!link.isOpen">folder</ng-container>
      <ng-container *ngIf="link.isOpen">folder_open</ng-container>
    </mat-icon>
  </div>
</ng-template>
<ng-template #footer>
  <ng-container *ngIf="link.children == null">
    <div *ngIf="link.lastUsed != null">{{link.lastUsed | date: 'dd.MM.yyyy, HH:mm'}}</div>
    <div *ngIf="link.lastUsed == null" i18n>never visited</div>
  </ng-container>
</ng-template>

<div (cdkDragStarted)="ds.dragstart($event)"
     [cdkDragData]="link"
     [cdkDragDisabled]="_dragDisabled"
     cdkDrag
     id="link-{{link.uniqueId}}">
  <ng-container [ngSwitch]="mode">
    <button (click)="clickLink($event, link)"
            *ngSwitchCase="'icon'"
            mat-flat-button>
      <ng-container *ngTemplateOutlet="icon"></ng-container>
      <div *ngIf="link.shortLabel != null" shortlabel>{{link.shortLabel}}</div>
    </button>
    <ng-container *ngSwitchCase="'full'">
      <ng-container [ngSwitch]="type">
        <ng-container *ngSwitchCase="'card'">
          <mat-card (click)="clickLink($event, link)" linkcard>
            <mat-card-header>
              <mat-card-title>
                <ng-container *ngTemplateOutlet="icon"></ng-container>
                <span>{{link.label}}</span>
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div *ngIf="link.children != null" class="children">
                <app-link-card *ngFor="let child of link.children" [link]="child"></app-link-card>
              </div>
              <div>{{link.info}}</div>
            </mat-card-content>
            <ng-container *ngIf="globals.appMode==='edit'">
              <mat-card-footer>
                <div>
                  <ng-container *ngTemplateOutlet="footer"></ng-container>
                </div>
              </mat-card-footer>
            </ng-container>
          </mat-card>
        </ng-container>
        <ng-container *ngSwitchCase="'grid'">
          <div (click)="clickLink($event, link)" grid linkcard>
            <div header>
              <ng-container *ngTemplateOutlet="icon"></ng-container>
              <span>{{link.label}}</span>
            </div>
            <div content>
              <div>{{link.info}}</div>
              <div *ngIf="link.children != null" [class]="classForChildren(link)">
                <app-link-card *ngFor="let child of link.children"
                               [link]="child"
                               [mode]="link.isOpen?'full':'icon'"></app-link-card>
              </div>
            </div>
            <ng-container *ngIf="globals.appMode==='edit'">
              <div footer>
                <ng-container *ngTemplateOutlet="footer"></ng-container>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
  <div *ngIf="globals.isDebug" unique>uid{{link.uniqueId}}</div>
</div>
